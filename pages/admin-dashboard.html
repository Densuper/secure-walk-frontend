<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="theme-color" content="#0b152d">
  <title>Admin Dashboard</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap">
  <link rel="stylesheet" href="../styles/main.css">
</head>
<body>
  <main class="dashboard">
    <header>
      <h1>Admin Dashboard</h1>
      <p id="adminWelcomeMessage" class="admin-welcome"></p>
    </header>

    <div class="card-grid">
      <div class="card section">
        <div>
          <h2>User Management</h2>
          <p class="muted">Add, update, or remove patrol officers and administrators.</p>
        </div>
        <button onclick="navigate('user-management.html')">Manage</button>
      </div>

      <div class="card section">
        <div>
          <h2>Walk History</h2>
          <p class="muted">Review completed patrols, checkpoints, and time-on-task.</p>
        </div>
        <button onclick="navigate('admin-walk-history.html')">View</button>
      </div>

      <div class="card section">
        <div>
          <h2>QR Code Management</h2>
          <p class="muted">Maintain the checkpoint inventory and update QR metadata.</p>
        </div>
        <button onclick="navigate('qr-management.html')">Open</button>
      </div>

      <div class="card section">
        <div>
          <h2>Reports &amp; Logs</h2>
          <p class="muted">Download audit trails and operational logs for compliance.</p>
        </div>
        <button onclick="navigate('logs.html')">Access</button>
      </div>
    </div>

    <div class="action-buttons">
      <button id="adminLogoutButton" class="secondary">Logout</button>
    </div>
  </main>

  <script>
    function navigate(url) {
      window.location.href = url;
    }
  </script>

  <script src="../scripts/data.js"></script>
  <script src="../scripts/app.js"></script>
  <script src="../scripts/theme.js" defer></script>
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      if (typeof initializeData === 'function') {
        initializeData();
      }

      const currentUser = typeof getCurrentUser === 'function' ? getCurrentUser() : null;

      if (!currentUser || currentUser.role !== 'admin') {
        alert('Access Denied. You are not authorized to view this page. Redirecting to login.');
        window.location.href = 'admin-login.html';
        return;
      }

      const welcomeElement = document.getElementById('adminWelcomeMessage');
      if (welcomeElement) {
        welcomeElement.textContent = `Welcome, Admin ${currentUser.username}!`;
      }

      const logoutButton = document.getElementById('adminLogoutButton');
      if (logoutButton) {
        logoutButton.addEventListener('click', () => {
          if (typeof logoutUser === 'function') {
            logoutUser();
          } else {
            localStorage.removeItem('currentUser');
            window.location.href = '../index.html';
          }
        });
      }
    });
  </script>
</body>
</html>
